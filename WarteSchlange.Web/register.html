<html>
    <head>
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

        <title>Registerd! - Please Wait</title>
        <link href="style.css" type="text/css" rel="stylesheet">
        
        <script type="application/javascript" src="qrcode.min.js"></script>
        
        <script>
            // Get QueueItemID
            var url_string = window.location.href;
            var url = new URL(url_string);
            var qItemID = url.searchParams.get("qItemID");
            //if(qItemID==null || qItemID=="") return;

            // API Request
            function makeRequest(url) {
                var request = new XMLHttpRequest();
                    var postDestination = url;
                    request.open("GET", postDestination, true);
                    request.setRequestHeader("Content-type", "text/plain");
                    request.onreadystatechange = function () {
                        if (request.readyState == 4 && request.status == 200) {
                            // Request done an OK!
                            return request.responseText;
                        }
                    }
                    request.send();
                }

            
            // Get people in front 

            // Get magic words

            // create QR Code
           
        </script>
    </head>
    
    <body>
        <div id="head">

        <h1>You are in the "<span id="namequeue"></span>"</h1>
            <span id="subtitle">Estimated Remaining Time:</span><br>
            
            <span id="time">(no estimate)</span><br>

            <span id="timeformat">minutes</span><br>
        </div>

        <div id="main">
            <div id="listbox">
                <div id="listheading">Waiting Information</div>
                <div id="row">
                    <div id="cellicon"><img src="person.png" id="listicon"></div>
                    <div id="celltext2">? people in front of you</div>
                </div>
                <div id="row">
                    <div id="cellicon">
                        <img src="average.jpg" id="listicon">
                    </div>
                    <div class="celltext">Average Waiting Time ~? min</div>
                </div>
                <div id="row">
                    <div id="cellicon">
                        <img src="up.png" id="listicon">
                    </div>
                    <div class="celltext">Max Time Customer</div>
                </div>
                <div id="row">
                    <div id="cellicon">
                        <img src="down.png" id="listicon">
                    </div>
                    <div class="celltext">Min Time Customer</div>
                </div>
                <div id="row" style="height: 400px;">
                    <div id="qrcode" style="width: 300px; height: 300px; display: block; margin-left: auto; margin-right: auto;"></div>
                </div>
            </div>
            <div id="listbox">
            <div id="listheading">Rollercoaster Queue</div>
            <img id="landingPicture" src="achterbahn.jpg" />
            <div id="text">
                <span id="description"></span>
            </div>
            <div id="row">
                <div id="cellicon">
                    <img src="time.png" id="listicon">
                </div>
                <div class="celltext" id="openingtimes">
            </div>
            <div id="row">
                <div id="cellicon">
                    <img src="starttime.png" id="listicon">
                </div>
                <div class="celltext">You entered at 08:43:21</div>
            </div>
            </div>
            </div>

            <div id="listbox">
                <div id="listheading">Company's Name</div>
                <div id="row">
                    <div id="cellicon">
                        <img src="location.png" id="listicon">
                    </div>
                    <div class="celltext">Karlsruhe</div>
                </div>
                <div id="row">
                    <div id="cellicon">
                        <img src="web.png" id="listicon">
                    </div>
                    <div class="celltext">www.company.de</div>
                </div>
                    <div id="row">
                        <div id="cellicon">
                            <img src="email.png" id="listicon">
                        </div>
                        <div class="celltext">com.pany@example.com</div>
                    </div>
                <div id="row">
                    <div id="cellicon">
                        <img src="phone.png" id="listicon">
                    </div>
                    <div class="celltext">+049 30300 243222</div>
                </div>
            </div>

            <a href="cancel.html" onclick="" id="button">Leave Queue</a>

        </div>
       



        <script>

            // Get estimated wait time
            function makeTimeRequest(url) {
                var request = new XMLHttpRequest();
                    var postDestination = url;
                    request.open("GET", postDestination, true);
                    request.setRequestHeader("Content-type", "text/plain");
                    request.onreadystatechange = function () {
                        if (request.readyState == 4 && request.status == 200) {
                            // Request done an OK!
                            document.getElementById("time").innerHTML = parseInt(request.responseText) / 60;
                        }
                    }
                    request.send();
                }
            makeTimeRequest("https://warteschlangeapi.azurewebsites.net/api/QueueInformation/getEstimatedWaitingTime/"+qItemID);

              function getQueueInfo(url) {
                var request = new XMLHttpRequest();
                    var postDestination = url;
                    request.open("GET", postDestination, true);
                    request.setRequestHeader("Content-type", "text/plain");
                    request.onreadystatechange = function () {
                        if (request.readyState == 4 && request.status == 200) {
                            // Request done an OK!
                            console.log(request.response);
                         
                            var jsonData = JSON.parse(request.response);
                            console.log(jsonData.name);
                            document.getElementById("description").innerHTML = jsonData.description;   
                            document.getElementById("namequeue").innerHTML = jsonData.name;   
                        //    document.getElementById("").innerHTML = "";   
                 

                        }
                    }
                    request.send();
                    
                }
                getQueueInfo("https://warteschlangeapi.azurewebsites.net/api/queue/2");
           
            

            new QRCode(document.getElementById("qrcode"), "google.de/"+qItemID);
        </script>

    </body>

</html>
    
